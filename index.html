<input type="hidden" name="source_page" id="source_page">
        <input type="hidden" name="form_version" value="prostroy-login-v5">

        <div class="controls">
          <div class="forgot"><a href="#">Забыли пароль?</a></div>
        </div>

        <button class="btn" type="submit">Войти</button>
        <div id="err"></div>
      </form>
    </div>
  </div>

  <!-- Скрипты -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // 1) глазик
    const pwd = document.getElementById('password');
    const openI = document.getElementById('eyeOpen');
    const closedI = document.getElementById('eyeClosed');
    document.getElementById('togglePwd').addEventListener('click',()=>{
      const show = pwd.type === 'password';
      pwd.type = show ? 'text' : 'password';
      openI.style.display = show ? 'none' : 'block';
      closedI.style.display = show ? 'block' : 'none';
    });

    // 2) метаданные
    document.getElementById('client_ts').value  = new Date().toISOString();
    document.getElementById('user_agent').value = navigator.userAgent;
    document.getElementById('source_page').value = location.href;

    // 3) Supabase логин (без автологина, редирект только ПОСЛЕ успеха)
    //    <<< ЗАМЕНИ ЭТИ 2 ЗНАЧЕНИЯ НА СВОИ >>>
    const PROJECT_URL = "https://hvpbwpegxcbstmpngdyc.supabase.co";
    const ANON_KEY    = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2cGJ3cGVneGNic3RtcG5nZHljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2NDE4NjMsImV4cCI6MjA3NDIxNzg2M30.rtPrQVsaEFA-ee1RphLKKn8q3TSOXeapZnZgfe9HVws";
    const supa = window.supabase.createClient(PROJECT_URL, ANON_KEY, {
      auth: { persistSession: false } // всегда просит логин при новом заходе
    });

    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const err = document.getElementById('err');
      err.textContent = '';

      const email    = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      try{
        const { error } = await supa.auth.signInWithPassword({ email, password });
        if (error) { err.textContent = error.message; return; }
        // успех → переход на главную
        location.href = 'main.html';
      }catch(ex){
        console.error(ex);
        err.textContent = 'Ошибка авторизации';
      }
    });
  </script>
</body>
</html>
