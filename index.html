<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Вход | ProStroy</title>

<!-- Supabase SDK v2 -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  // === ВСТАВЬ СВОИ КЛЮЧИ ИЗ SUPABASE (Settings → API) ===
  const PROJECT_URL = "YOUR_PROJECT_URL";   // напр. https://xxxx.supabase.co
  const ANON_KEY    = "YOUR_ANON_KEY";      // public anon key
  const supa = supabase.createClient(PROJECT_URL, ANON_KEY);

  // если уже авторизован — сразу на главную
  window.addEventListener('DOMContentLoaded', async () => {
    const { data: { session } } = await supa.auth.getSession();
    if (session) location.href = 'main.html';

    // метаданные (оставил как у тебя)
    document.getElementById('client_ts').value = new Date().toISOString();
    document.getElementById('user_agent').value = navigator.userAgent;
    document.getElementById('source_page').value = location.href;
  });

  async function loginSupabase(ev){
    ev.preventDefault();
    const email = document.getElementById('login').value.trim();
    const password = document.getElementById('password').value.trim();
    const errEl = document.getElementById('err');

    // Supabase логинит по email+пароль
    if (!email.includes('@')) {
      errEl.textContent = 'Введите e-mail (авторизация по email и паролю).';
      return;
    }

    const { error } = await supa.auth.signInWithPassword({ email, password });
    if (error) { errEl.textContent = error.message; return; }

    // успех → мгновенный переход
    location.href = 'main.html';
  }

  // показать/скрыть пароль
  function togglePwd(){
    const pwd = document.getElementById('password');
    const show = pwd.type === 'password';
    pwd.type = show ? 'text' : 'password';
    document.getElementById('eyeOpen').style.display   = show ? 'none' : 'block';
    document.getElementById('eyeClosed').style.display = show ? 'block' : 'none';
  }
</script>

<style>
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#fff;overflow:hidden}

  /* BG video */
  .bg video{position:fixed;inset:0;width:100vw;height:100vh;object-fit:cover;z-index:-2}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:-1}

  /* Card */
  .wrap{height:100%;display:grid;place-items:center;padding:24px}
  .card{
    width:min(92vw, 900px); max-width:900px;
    padding:36px 40px; border-radius:20px;
    background:rgba(255,255,255,.10);
    backdrop-filter:blur(14px) saturate(140%);
    -webkit-backdrop-filter:blur(14px) saturate(140%);
    border:1px solid rgba(255,255,255,.18); box-shadow:0 10px 30px rgba(0,0,0,.35)
  }
  h1{margin:0 0 6px;font-size:40px;text-align:center}
  .subtitle{margin:0 0 28px;text-align:center;color:#d1d5db}

  .form{max-width:720px;margin:0 auto}
  .row{margin-bottom:16px}
  label{display:block;margin-bottom:8px;font-size:15px;color:#e5e7eb}

  .field{position:relative}
  input[type="text"],input[type="password"]{
    width:100%;height:52px;padding:14px 48px 14px 16px;
    border-radius:12px;border:1px solid rgba(255,255,255,.25);
    background:rgba(255,255,255,.14);color:#fff;outline:none
  }
  input::placeholder{color:#cbd5e1}
  input:focus{box-shadow:0 0 0 4px rgba(34,197,94,.18);border-color:rgba(34,197,94,.7)}

  /* Eye icon */
  .eye{position:absolute;right:12px;top:50%;transform:translateY(-50%);
       width:28px;height:28px;display:grid;place-items:center;
       background:transparent;border:none;cursor:pointer;outline:none}
  .eye svg{width:22px;height:22px;fill:#e5e7eb;opacity:.9}

  /* Controls */
  .controls{max-width:720px;margin:6px auto 0}
  .remember-line{display:flex;align-items:center;gap:10px}
  .remember-line span{font-size:15px}
  .remember-line input[type="checkbox"]{
    margin-left:auto;width:18px;height:18px;accent-color:#22c55e;cursor:pointer
  }
  .forgot{margin-top:6px;text-align:right}
  .forgot a{color:#7dd3fc;text-decoration:none;font-size:15px}

  .btn{display:block;width:100%;max-width:720px;margin:16px auto 0;height:52px;
       border:none;border-radius:12px;background:#22c55e;color:#fff;
       font-weight:800;letter-spacing:.2px;cursor:pointer}
  .btn:hover{background:#16a34a}

  #err{margin-top:10px;color:#ff7a7a;min-height:22px}
</style>
</head>
<body>
  <!-- Background video -->
  <div class="bg">
    <video autoplay
